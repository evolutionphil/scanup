{"dependencies":[{"name":"../embedders/CustomFontEmbedder.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":68,"index":68}}],"key":"7VVX7jBSt6ekMXrxetnupnp0llg=","exportNames":["*"],"imports":1}},{"name":"../objects/PDFHexString.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":69},"end":{"line":2,"column":54,"index":123}}],"key":"6YgZriOXHpqHcpt3Yy3oAwRvFRA=","exportNames":["*"],"imports":1}},{"name":"../../utils/index.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":124},"end":{"line":3,"column":87,"index":211}}],"key":"AUCnYNcCot7PlCuuOg5nVchJREc=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _embeddersCustomFontEmbedderJs = require(_dependencyMap[0], \"../embedders/CustomFontEmbedder.js\");\n  var CustomFontEmbedder = _interopDefault(_embeddersCustomFontEmbedderJs);\n  var _objectsPDFHexStringJs = require(_dependencyMap[1], \"../objects/PDFHexString.js\");\n  var PDFHexString = _interopDefault(_objectsPDFHexStringJs);\n  var _utilsIndexJs = require(_dependencyMap[2], \"../../utils/index.js\");\n  /**\n   * A note of thanks to the developers of https://github.com/foliojs/pdfkit, as\n   * this class borrows from:\n   *   https://github.com/devongovett/pdfkit/blob/e71edab0dd4657b5a767804ba86c94c58d01fbca/lib/image/jpeg.coffee\n   */\n  class CustomFontSubsetEmbedder extends CustomFontEmbedder.default {\n    static async for(fontkit, fontData, customFontName, fontFeatures) {\n      const font = await fontkit.create(fontData);\n      return new CustomFontSubsetEmbedder(font, fontData, customFontName, fontFeatures);\n    }\n    constructor(font, fontData, customFontName, fontFeatures) {\n      super(font, fontData, customFontName, fontFeatures);\n      this.subset = this.font.createSubset();\n      this.glyphs = [];\n      this.glyphCache = _utilsIndexJs.Cache.populatedBy(() => this.glyphs);\n      this.glyphIdMap = new Map();\n    }\n    encodeText(text) {\n      const {\n        glyphs\n      } = this.font.layout(text, this.fontFeatures);\n      const hexCodes = new Array(glyphs.length);\n      for (let idx = 0, len = glyphs.length; idx < len; idx++) {\n        const glyph = glyphs[idx];\n        const subsetGlyphId = this.subset.includeGlyph(glyph);\n        this.glyphs[subsetGlyphId - 1] = glyph;\n        this.glyphIdMap.set(glyph.id, subsetGlyphId);\n        hexCodes[idx] = (0, _utilsIndexJs.toHexStringOfMinLength)(subsetGlyphId, 4);\n      }\n      this.glyphCache.invalidate();\n      return PDFHexString.default.of(hexCodes.join(''));\n    }\n    isCFF() {\n      return this.subset.cff;\n    }\n    glyphId(glyph) {\n      return glyph ? this.glyphIdMap.get(glyph.id) : -1;\n    }\n    serializeFont() {\n      return new Promise((resolve, reject) => {\n        const parts = [];\n        this.subset.encodeStream().on('data', bytes => parts.push(bytes)).on('end', () => resolve((0, _utilsIndexJs.mergeUint8Arrays)(parts))).on('error', err => reject(err));\n      });\n    }\n  }\n  var _default = CustomFontSubsetEmbedder;\n});","lineCount":69,"map":[[12,2,51,0,"Object"],[12,8,51,0],[12,9,51,0,"defineProperty"],[12,23,51,0],[12,24,51,0,"exports"],[12,31,51,0],[13,4,51,0,"enumerable"],[13,14,51,0],[14,4,51,0,"get"],[14,7,51,0],[14,18,51,0,"get"],[14,19,51,0],[15,6,51,0],[15,13,51,0,"_default"],[15,21,51,0],[16,4,51,0],[17,2,51,0],[18,2,1,0],[18,6,1,0,"_embeddersCustomFontEmbedderJs"],[18,36,1,0],[18,39,1,0,"require"],[18,46,1,0],[18,47,1,0,"_dependencyMap"],[18,61,1,0],[19,2,1,0],[19,6,1,0,"CustomFontEmbedder"],[19,24,1,0],[19,27,1,0,"_interopDefault"],[19,42,1,0],[19,43,1,0,"_embeddersCustomFontEmbedderJs"],[19,73,1,0],[20,2,2,0],[20,6,2,0,"_objectsPDFHexStringJs"],[20,28,2,0],[20,31,2,0,"require"],[20,38,2,0],[20,39,2,0,"_dependencyMap"],[20,53,2,0],[21,2,2,0],[21,6,2,0,"PDFHexString"],[21,18,2,0],[21,21,2,0,"_interopDefault"],[21,36,2,0],[21,37,2,0,"_objectsPDFHexStringJs"],[21,59,2,0],[22,2,3,0],[22,6,3,0,"_utilsIndexJs"],[22,19,3,0],[22,22,3,0,"require"],[22,29,3,0],[22,30,3,0,"_dependencyMap"],[22,44,3,0],[23,2,4,0],[24,0,5,0],[25,0,6,0],[26,0,7,0],[27,0,8,0],[28,2,9,0],[28,8,9,6,"CustomFontSubsetEmbedder"],[28,32,9,30],[28,41,9,39,"CustomFontEmbedder"],[28,59,9,57],[28,60,9,57,"default"],[28,67,9,57],[28,68,9,58],[29,4,10,4],[29,17,10,17,"for"],[29,20,10,20,"for"],[29,21,10,21,"fontkit"],[29,28,10,28],[29,30,10,30,"fontData"],[29,38,10,38],[29,40,10,40,"customFontName"],[29,54,10,54],[29,56,10,56,"fontFeatures"],[29,68,10,68],[29,70,10,70],[30,6,11,8],[30,12,11,14,"font"],[30,16,11,18],[30,19,11,21],[30,25,11,27,"fontkit"],[30,32,11,34],[30,33,11,35,"create"],[30,39,11,41],[30,40,11,42,"fontData"],[30,48,11,50],[30,49,11,51],[31,6,12,8],[31,13,12,15],[31,17,12,19,"CustomFontSubsetEmbedder"],[31,41,12,43],[31,42,12,44,"font"],[31,46,12,48],[31,48,12,50,"fontData"],[31,56,12,58],[31,58,12,60,"customFontName"],[31,72,12,74],[31,74,12,76,"fontFeatures"],[31,86,12,88],[31,87,12,89],[32,4,13,4],[33,4,14,4,"constructor"],[33,15,14,15,"constructor"],[33,16,14,16,"font"],[33,20,14,20],[33,22,14,22,"fontData"],[33,30,14,30],[33,32,14,32,"customFontName"],[33,46,14,46],[33,48,14,48,"fontFeatures"],[33,60,14,60],[33,62,14,62],[34,6,15,8],[34,11,15,13],[34,12,15,14,"font"],[34,16,15,18],[34,18,15,20,"fontData"],[34,26,15,28],[34,28,15,30,"customFontName"],[34,42,15,44],[34,44,15,46,"fontFeatures"],[34,56,15,58],[34,57,15,59],[35,6,16,8],[35,10,16,12],[35,11,16,13,"subset"],[35,17,16,19],[35,20,16,22],[35,24,16,26],[35,25,16,27,"font"],[35,29,16,31],[35,30,16,32,"createSubset"],[35,42,16,44],[35,43,16,45],[35,44,16,46],[36,6,17,8],[36,10,17,12],[36,11,17,13,"glyphs"],[36,17,17,19],[36,20,17,22],[36,22,17,24],[37,6,18,8],[37,10,18,12],[37,11,18,13,"glyphCache"],[37,21,18,23],[37,24,18,26,"Cache"],[37,37,18,31],[37,38,18,31,"Cache"],[37,43,18,31],[37,44,18,32,"populatedBy"],[37,55,18,43],[37,56,18,44],[37,62,18,50],[37,66,18,54],[37,67,18,55,"glyphs"],[37,73,18,61],[37,74,18,62],[38,6,19,8],[38,10,19,12],[38,11,19,13,"glyphIdMap"],[38,21,19,23],[38,24,19,26],[38,28,19,30,"Map"],[38,31,19,33],[38,32,19,34],[38,33,19,35],[39,4,20,4],[40,4,21,4,"encodeText"],[40,14,21,14,"encodeText"],[40,15,21,15,"text"],[40,19,21,19],[40,21,21,21],[41,6,22,8],[41,12,22,14],[42,8,22,16,"glyphs"],[43,6,22,23],[43,7,22,24],[43,10,22,27],[43,14,22,31],[43,15,22,32,"font"],[43,19,22,36],[43,20,22,37,"layout"],[43,26,22,43],[43,27,22,44,"text"],[43,31,22,48],[43,33,22,50],[43,37,22,54],[43,38,22,55,"fontFeatures"],[43,50,22,67],[43,51,22,68],[44,6,23,8],[44,12,23,14,"hexCodes"],[44,20,23,22],[44,23,23,25],[44,27,23,29,"Array"],[44,32,23,34],[44,33,23,35,"glyphs"],[44,39,23,41],[44,40,23,42,"length"],[44,46,23,48],[44,47,23,49],[45,6,24,8],[45,11,24,13],[45,15,24,17,"idx"],[45,18,24,20],[45,21,24,23],[45,22,24,24],[45,24,24,26,"len"],[45,27,24,29],[45,30,24,32,"glyphs"],[45,36,24,38],[45,37,24,39,"length"],[45,43,24,45],[45,45,24,47,"idx"],[45,48,24,50],[45,51,24,53,"len"],[45,54,24,56],[45,56,24,58,"idx"],[45,59,24,61],[45,61,24,63],[45,63,24,65],[46,8,25,12],[46,14,25,18,"glyph"],[46,19,25,23],[46,22,25,26,"glyphs"],[46,28,25,32],[46,29,25,33,"idx"],[46,32,25,36],[46,33,25,37],[47,8,26,12],[47,14,26,18,"subsetGlyphId"],[47,27,26,31],[47,30,26,34],[47,34,26,38],[47,35,26,39,"subset"],[47,41,26,45],[47,42,26,46,"includeGlyph"],[47,54,26,58],[47,55,26,59,"glyph"],[47,60,26,64],[47,61,26,65],[48,8,27,12],[48,12,27,16],[48,13,27,17,"glyphs"],[48,19,27,23],[48,20,27,24,"subsetGlyphId"],[48,33,27,37],[48,36,27,40],[48,37,27,41],[48,38,27,42],[48,41,27,45,"glyph"],[48,46,27,50],[49,8,28,12],[49,12,28,16],[49,13,28,17,"glyphIdMap"],[49,23,28,27],[49,24,28,28,"set"],[49,27,28,31],[49,28,28,32,"glyph"],[49,33,28,37],[49,34,28,38,"id"],[49,36,28,40],[49,38,28,42,"subsetGlyphId"],[49,51,28,55],[49,52,28,56],[50,8,29,12,"hexCodes"],[50,16,29,20],[50,17,29,21,"idx"],[50,20,29,24],[50,21,29,25],[50,24,29,28],[50,28,29,28,"toHexStringOfMinLength"],[50,41,29,50],[50,42,29,50,"toHexStringOfMinLength"],[50,64,29,50],[50,66,29,51,"subsetGlyphId"],[50,79,29,64],[50,81,29,66],[50,82,29,67],[50,83,29,68],[51,6,30,8],[52,6,31,8],[52,10,31,12],[52,11,31,13,"glyphCache"],[52,21,31,23],[52,22,31,24,"invalidate"],[52,32,31,34],[52,33,31,35],[52,34,31,36],[53,6,32,8],[53,13,32,15,"PDFHexString"],[53,25,32,27],[53,26,32,27,"default"],[53,33,32,27],[53,34,32,28,"of"],[53,36,32,30],[53,37,32,31,"hexCodes"],[53,45,32,39],[53,46,32,40,"join"],[53,50,32,44],[53,51,32,45],[53,53,32,47],[53,54,32,48],[53,55,32,49],[54,4,33,4],[55,4,34,4,"isCFF"],[55,9,34,9,"isCFF"],[55,10,34,9],[55,12,34,12],[56,6,35,8],[56,13,35,15],[56,17,35,19],[56,18,35,20,"subset"],[56,24,35,26],[56,25,35,27,"cff"],[56,28,35,30],[57,4,36,4],[58,4,37,4,"glyphId"],[58,11,37,11,"glyphId"],[58,12,37,12,"glyph"],[58,17,37,17],[58,19,37,19],[59,6,38,8],[59,13,38,15,"glyph"],[59,18,38,20],[59,21,38,23],[59,25,38,27],[59,26,38,28,"glyphIdMap"],[59,36,38,38],[59,37,38,39,"get"],[59,40,38,42],[59,41,38,43,"glyph"],[59,46,38,48],[59,47,38,49,"id"],[59,49,38,51],[59,50,38,52],[59,53,38,55],[59,54,38,56],[59,55,38,57],[60,4,39,4],[61,4,40,4,"serializeFont"],[61,17,40,17,"serializeFont"],[61,18,40,17],[61,20,40,20],[62,6,41,8],[62,13,41,15],[62,17,41,19,"Promise"],[62,24,41,26],[62,25,41,27],[62,26,41,28,"resolve"],[62,33,41,35],[62,35,41,37,"reject"],[62,41,41,43],[62,46,41,48],[63,8,42,12],[63,14,42,18,"parts"],[63,19,42,23],[63,22,42,26],[63,24,42,28],[64,8,43,12],[64,12,43,16],[64,13,43,17,"subset"],[64,19,43,23],[64,20,44,17,"encodeStream"],[64,32,44,29],[64,33,44,30],[64,34,44,31],[64,35,45,17,"on"],[64,37,45,19],[64,38,45,20],[64,44,45,26],[64,46,45,29,"bytes"],[64,51,45,34],[64,55,45,39,"parts"],[64,60,45,44],[64,61,45,45,"push"],[64,65,45,49],[64,66,45,50,"bytes"],[64,71,45,55],[64,72,45,56],[64,73,45,57],[64,74,46,17,"on"],[64,76,46,19],[64,77,46,20],[64,82,46,25],[64,84,46,27],[64,90,46,33,"resolve"],[64,97,46,40],[64,98,46,41],[64,102,46,41,"mergeUint8Arrays"],[64,115,46,57],[64,116,46,57,"mergeUint8Arrays"],[64,132,46,57],[64,134,46,58,"parts"],[64,139,46,63],[64,140,46,64],[64,141,46,65],[64,142,46,66],[64,143,47,17,"on"],[64,145,47,19],[64,146,47,20],[64,153,47,27],[64,155,47,30,"err"],[64,158,47,33],[64,162,47,38,"reject"],[64,168,47,44],[64,169,47,45,"err"],[64,172,47,48],[64,173,47,49],[64,174,47,50],[65,6,48,8],[65,7,48,9],[65,8,48,10],[66,4,49,4],[67,2,50,0],[68,2,51,0],[68,6,51,0,"_default"],[68,14,51,0],[68,17,51,15,"CustomFontSubsetEmbedder"],[68,41,51,39],[69,0,51,40],[69,3]],"functionMap":{"names":["<global>","CustomFontSubsetEmbedder","_for","constructor","Cache.populatedBy$argument_0","encodeText","isCFF","glyphId","serializeFont","Promise$argument_0","subset.encodeStream.on$argument_1","subset.encodeStream.on.on$argument_1","subset.encodeStream.on.on.on$argument_1"],"mappings":"AAA;ACQ;ICC;KDG;IEC;4CCI,iBD;KFE;IIC;KJY;IKC;KLE;IMC;KNE;IOC;2BCC;4BCI,4BD;2BEC,sCF;6BGC,oBH;SDC;KPC;CDC"},"hasCjsExports":false},"type":"js/module"}]}